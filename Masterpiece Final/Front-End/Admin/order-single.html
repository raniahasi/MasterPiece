<!DOCTYPE html>
<html lang="en">


<!-- Mirrored from codescandy.com/geeks-bootstrap-5/pages/dashboard/ecommerce/add-product.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 06 Sep 2024 16:29:45 GMT -->
<head>  <!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="Codescandy">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M8S4MT3EYG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M8S4MT3EYG');
</script>



<script>
    // Render blocking JS:
    if (localStorage.theme) document.documentElement.setAttribute("data-theme", localStorage.theme);
    </script>

<!-- Favicon icon-->
<link rel="shortcut icon" type="image/x-icon" href="https://codescandy.com/geeks-bootstrap-5/assets/images/favicon/favicon.ico">


<!-- Libs CSS -->
<link href="assets/fonts/feather/feather.css" rel="stylesheet">
<link href="assets/libs/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
<link href="assets/libs/%40mdi/font/css/materialdesignicons.min.css" rel="stylesheet" />
<link href="assets/libs/simplebar/dist/simplebar.min.css" rel="stylesheet">




<!-- Theme CSS -->
<link rel="stylesheet" href="assets/css/theme.min.css">

  <link href="assets/libs/dropzone/dist/dropzone.css" rel="stylesheet" >
  <link href="assets/libs/%40yaireo/tagify/dist/tagify.css" rel="stylesheet">
  <title>Order Details</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

</head>

<body>
     <!-- Wrapper -->
     <div id="db-wrapper">
        <!-- navbar vertical -->
      <!-- navbar vertical -->
      <nav class="navbar-vertical navbar">
        <div class="vh-100" data-simplebar>
            <!-- Brand logo -->
            <a class="navbar-brand" href="https://codescandy.com/geeks-bootstrap-5/index.html">
            </a>
                <!-- Navbar nav -->
                <ul class="navbar-nav flex-column" id="sideNavbar">
    
    
    
    
                    <!-- Nav item User -->
        
                    <li class="nav-item">
                        <a class="nav-link " href="Users.html">
                            <i class="fas fa-user" style="font-size:24px"></i>
                            </i> User
                        </a>
        
                    </li>
        
        
                    <li class="nav-item">
                        <a class="nav-link " href="Add-Admin.html">
                            <i class="fas fa-user" style="font-size:24px"></i>
                            </i> Add Admin
                        </a>
        
                    </li>
        
        
                    <!-- Nav item Orders -->
                    <li class="nav-item">
                        <a class="nav-link " href="order.html">
                            <i class='fas fa-receipt' style='font-size:24px'></i>
                            </i> &nbsp; &nbsp;Orders
        
                        </a>
                    </li>
        
        
        
        
        
        
        
                    <!-- Nav item Categories -->
        
                    <li class="nav-item">
                        <a class="nav-link   collapsed " href="#" data-bs-toggle="collapse"
                            data-bs-target="#navDashboard" aria-expanded="false" aria-controls="navDashboard">
                            <i class="fas fa-th-large" style="font-size:24px"></i>
                            &nbsp; Categories
                        </a>
                        <div id="navDashboard" class="collapse " data-bs-parent="#sideNavbar">
                            <ul class="nav flex-column">
                                <li class="nav-item ">
                                    <a class="nav-link " href="addCategory.html">
                                        Add Category
                                    </a>
                                </li>
                                <!-- Nav item -->
                                <li class="nav-item ">
                                    <a class="nav-link " href="categories.html">
                                        View ALL Categories
        
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
        
        
        
        
        
        
                    <!-- Nav item Products -->
        
                    <li class="nav-item">
                        <a class="nav-link   collapsed " href="#" data-bs-toggle="collapse"
                            data-bs-target="#navDashboard" aria-expanded="false" aria-controls="navDashboard">
                            <i class="fas fa-box" style="font-size:24px"></i>
                            &nbsp; Products
                        </a>
                        <div id="navDashboard" class="collapse " data-bs-parent="#sideNavbar">
                            <ul class="nav flex-column">
                                <li class="nav-item ">
                                    <a class="nav-link " href="Add-product.html">
                                        Add Products
                                    </a>
                                </li>
                                <!-- Nav item -->
                                <li class="nav-item ">
                                    <a class="nav-link " href="admin-products.html">
                                        View ALL Products
        
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
        
        
        <!-- Nav item Comment -->
        <li class="nav-item">
            <a class="nav-link " href="Comment.html">
                <i class="fas fa-comment" style="font-size:24px"></i>

                </i> &nbsp; &nbsp;Comments

            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link " href="contact.html">
                <i class="fas fa-comment" style="font-size:24px"></i>

                </i> &nbsp; &nbsp;Contact Us

            </a>
        </li>
     
                 
        
        
            
        
        
                    <!-- Nav item  Chat-->
                   
        
                </ul>
            </div>
        
        
        </nav>

        <!-- Main Content -->
        <div class="container mt-5" id="page-content">
            <h2 class="mb-4">Order Details</h2>
            <div id="orderDetails" class="mt-4">
                <!-- Order details will be displayed here -->
            </div>
        </div>
    </div>

    <!-- <script>
        // Function to get the order ID from local storage
        function getOrderIdFromStorage() {
            return localStorage.getItem('orderId');
        }

        // Function to fetch and display order details
        async function fetchOrderDetails() {
            const orderId = getOrderIdFromStorage();
            if (!orderId) {
                document.getElementById("orderDetails").innerHTML = "<p class='text-danger'>Error: Order ID is missing.</p>";
                return;
            }

            try {
                const response = await fetch(`https://localhost:7011/api/Order/GetOrderDetails/${orderId}`);
                const data = await response.json();

                console.log("Order Details:", data); // Log the response to debug

                if (!data) {
                    document.getElementById("orderDetails").innerHTML = "<p class='text-danger'>Error: Order details not found.</p>";
                    return;
                }

                // Calculate the total price of all items
                let itemsTotal = 0;
                const items = data.items?.$values || [];
                items.forEach(item => {
                    const itemTotal = (item.quantity || 0) * (item.price || 0);
                    itemsTotal += itemTotal;
                });

                // Calculate the final total amount (Delivery Cost + Items Total)
                const deliveryCost = data.deliveryCost || 0;
                const finalTotalAmount = deliveryCost + itemsTotal;

                // Build the HTML for order details
                let orderDetailsHTML = `
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Order ID: ${data.orderId}</h4>
                            <p><strong>Status:</strong> ${data.status || "N/A"}</p>
                            <p><strong>Order Date:</strong> ${data.date || "N/A"}</p>
                            <p><strong>Customer Name:</strong> ${data.user?.name || "N/A"}</p>
                            <p><strong>Phone Number:</strong> ${data.phoneNumber || "N/A"}</p>
                            <p><strong>Delivery Address:</strong> ${data.address || "N/A"}</p>
                            <p><strong>Region:</strong> ${data.regionName || "N/A"}</p>
                            <p><strong>Delivery Cost:</strong> ${deliveryCost.toFixed(2)} JD</p>
                        </div>
                    </div>
                    <h5 class="mt-4">Order Items</h5>
                    <table class="table table-hover table-bordered">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Total</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                // Add items to the table
                items.forEach(item => {
                    const itemTotal = (item.quantity || 0) * (item.price || 0);
                    orderDetailsHTML += `
                        <tr>
                            <td>${item.productName || "N/A"}</td>
                            <td>${item.quantity || 0}</td>
                            <td>${(item.price || 0).toFixed(2)} JD</td>
                            <td>${itemTotal.toFixed(2)} JD</td>
                        </tr>
                    `;
                });

                orderDetailsHTML += `
                        </tbody>
                    </table>
                    <h5 class="mt-3"><strong>Total Amount:</strong> ${finalTotalAmount.toFixed(2)} JD</h5>
                `;

                // Display the order details
                document.getElementById("orderDetails").innerHTML = orderDetailsHTML;

            } catch (error) {
                console.error("Error fetching order details:", error);
                document.getElementById("orderDetails").innerHTML = "<p class='text-danger'>Error loading order details.</p>";
            }
        }

        // Fetch order details when the page loads
        document.addEventListener("DOMContentLoaded", fetchOrderDetails);
    </script> -->







<!-- HTML & JavaScript Code -->
<script>
    // Function to get the order ID from local storage
    function getOrderIdFromStorage() {
        return localStorage.getItem('orderId');
    }

    // Function to update the order status
    async function updateOrderStatus(newStatus) {
        const orderId = getOrderIdFromStorage();
        if (!orderId) {
            alert("Error: Order ID is missing.");
            return;
        }

        try {
            const statusUpdate = { Status: newStatus }; // Create the status update object

            // Make a PUT request to update the order status
            const response = await fetch(`https://localhost:7159/api/Order/UpdateOrderStatus/${orderId}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(statusUpdate)
            });

            if (response.ok) {
                alert("Order status updated successfully!");
                fetchOrderDetails(); // Refresh the order details
            } else {
                const error = await response.json();
                alert(`Error updating order status: ${error.message}`);
            }
        } catch (error) {
            console.error("Error updating order status:", error);
            alert("An error occurred while updating the order status.");
        }
    }

    // Function to fetch and display order details, including order items
    async function fetchOrderDetails() {
        const orderId = getOrderIdFromStorage();
        if (!orderId) {
            document.getElementById("orderDetails").innerHTML = "<p class='text-danger'>Error: Order ID is missing.</p>";
            return;
        }

        try {
            const response = await fetch(`https://localhost:7159/api/Order/GetOrderDetails/${orderId}`);
            const data = await response.json();

            if (!data) {
                document.getElementById("orderDetails").innerHTML = "<p class='text-danger'>Error: Order details not found.</p>";
                return;
            }

            // Debug: Log the full data object to the console
            console.log("Full Order Details from API:", data);

            // Build the HTML for order details
            let orderDetailsHTML = `
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Order ID: ${data.orderId}</h4>
                        <p><strong>Order Date:</strong> ${data.date || "N/A"}</p>
                        <p><strong>Status:</strong> ${data.status || "N/A"}</p>

                        <p><strong>Total Amount:</strong> ${data.totalAmount?.toFixed(2) || "0.00"} JD</p>
                        <p><strong>Customer Name:</strong> ${data.customer?.name || "N/A"}</p>
                        <p><strong>Customer Phone:</strong> ${data.customer?.phoneNumber || "N/A"}</p>
                                    <p><strong>Email Address:</strong> ${data.customer?.email || "N/A"}</p>

                        <!-- Status Dropdown -->
                        <p><strong>Change Status:</strong>
                            <select id="statusDropdown" onchange="updateOrderStatus(this.value)">
                                <option value="0" ${data.status === "Pending" ? "selected" : ""}>Pending</option>
                                <option value="1" ${data.status === "Completed" ? "selected" : ""}>Completed</option>
                            </select>
                        </p>
                    </div>
                </div>

                <h5 class="mt-4">Order Items</h5>
                <table class="table table-hover table-bordered">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // Add each order item to the table
            data.orderItems.forEach(item => {
                const itemTotal = (item.quantity || 0) * (item.price || 0);
                orderDetailsHTML += `
                    <tr>
                        <td>${item.productName || "N/A"}</td>
                        <td>${item.quantity || 0}</td>
                        <td>${(item.price || 0).toFixed(2)} JD</td>
                        <td>${itemTotal.toFixed(2)} JD</td>
                    </tr>
                `;
            });

            orderDetailsHTML += `
                    </tbody>
                </table>
            `;

            // Display the order details and items
            document.getElementById("orderDetails").innerHTML = orderDetailsHTML;

        } catch (error) {
            console.error("Error fetching order details:", error);
            document.getElementById("orderDetails").innerHTML = "<p class='text-danger'>Error loading order details.</p>";
        }
    }

    // Fetch order details when the page loads
    document.addEventListener("DOMContentLoaded", fetchOrderDetails);
</script>




    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>
